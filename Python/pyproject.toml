[build-system]
requires = [
    "setuptools>=42",
    "wheel",
    "numpy"
]
build-backend = "setuptools.build_meta"

[tool.cibuildwheel.macos]
repair-wheel-command = [
  "DYLD_LIBRARY_PATH=/usr/local/lib delocate-listdeps {wheel}",
  "DYLD_LIBRARY_PATH=/usr/local/lib delocate-wheel --require-archs {delocate_archs} -w {dest_dir} {wheel}",
]

[tool.cibuildwheel.linux]
before-all = ["yum clean all",
              "yum install -y glpk glpk-devel mesa-libGLU-devel git",
              "pip install cmake",
              "git clone https://github.com/krishauser/Klampt.git",
              "pushd Klampt/Cpp/Dependencies",
              "make unpack-deps",
              "git clone https://github.com/assimp/assimp.git",
              "pushd assimp",
              "cmake -DASSIMP_BUILD_TESTS=OFF . && make -j 8 && make install",
              "popd",
              "pushd glew-2.1.0",
              "make -j && make install",
              "popd",
              "make dep-tinyxml && make dep-ode",
              "pushd KrisLibrary",
              "cmake . -DC11_ENABLED=ON -DUSE_GLUT=OFF -DUSE_GLUI=OFF  && make -j",
              "popd",
              "popd",
              "pushd Klampt",
              "cmake . && make -j Klampt",
              "popd",
              "rm -rf build || true",
              "rm -rf CMakeFiles || true",
              "rm -f CMakeCache.txt || true",
              "cmake -DKLAMPT_ROOT=./Klampt ."]

repair-wheel-command = "auditwheel repair --exclude libGLX.so.0 --exclude libGLdispatch.so.0 -w {dest_dir} {wheel}"

#skip all PyPy versions due to problems with Numpy include
skip = "pp*"
#skip = "cp*"

#archs = ["x86_64"]
#i686 doesn't work due to missing GLPK
#archs = ["i686"]
archs = ["aarch64"]